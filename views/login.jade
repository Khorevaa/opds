extends layout

block content
    h1= title
    h2 Войдите или зарегистрируйтесь!
    p Если вы еще не регистрировались логин (email) и пароль будут созданы впервые.
        form.form-horizontal.login-form(name='login-form' action='/login', method='post')
            .form-group
                label.col-lg-2.control-label(for='input-email') Электронный адрес
                .col-lg-10
                    input#input-email.form-control(name='email', value='', type='text', placeholder='name@smth.com')
            .form-group
                label.col-lg-2.control-label(for='input-password') Пароль
                .col-lg-10
                    input#input-password.form-control(name='password', value='', type='password', placeholder='Пароль' required)
            .form-group
                .col-lg-offset-2.col-lg-10
                    button.btn.btn-primary(type='submit', data-loading-text='Отправляю...') Войти
                    span.help-block.error
        .social-login
            a(href='/auth/facebook')
                i.fa.fa-facebook.fa-lg
                |         Login in with facebook
            a(href='/auth/google')
                i.fa.fa-google-plus.fa-lg
                |         log in with Google
        script.
            $(document.forms['login-form']).on('submit', function () {
                var form = $(this);

                $('.error', form).html('');
                $(':submit', form).button('loading');

                $.ajax({
                    url: '/login',
                    method: 'POST',
                    data: form.serialize(),
                    complete: function () {
                        $(':submit', form).button('reset');
                    },
                    statusCode: {
                        200: function () {
                            form.html('Вы вошли в кабинет').addClass('alert-success');
                            window.location.href = '/cabinet';
                        },
                        403: function (jqXHR) {
                            var error = JSON.parse(jqXHR.responseText);
                            $('.error', form).html(error.message);
                        }
                    }
                });
                return false;
            });